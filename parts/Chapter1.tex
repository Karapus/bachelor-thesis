\chapter{Основные сведения из теории компиляторов}
\label{sec:Chapter1} \index{Chapter1}

\section{Циклы}

Под циклом\cite{Muchnick_Loops} в данной работе подразумевается максимальное подмножество вершин графа потока управления, такое что:
\begin{itemize}
    \item Индуцированный подграф сильно связан.
    \item Все ребра, входящие в подмножество, направлены в единственную вершину - заголовок.
\end{itemize}

Для дальнейшего описания обработки циклов в компиляторной инфраструктуре, требуются следующие определения:
\begin{itemize}
    \item Входной блок (англ. entering block) - базовый блок, не принадлежащий циклу и имеющий ребро, ведущее в заголовок цикла.
    \item Предзаголовок цикла (англ. preheader) - единственный входной блок цикла.
    \item Выходящее ребро (англ. exiting edge) - ребро, направленное из блока внутри цикла в блок вне цикла.
    \item Блок выхода (англ. exit block) - блок, в который ведет выходящее ребро.
\end{itemize}

\section{Упрощенное представление циклов}

Для упрощения описания трансформаций циклов, в компиляторной инфраструктуре применяются различные внутренние представления.
Основное такое представление это упрощенное представление цикла (англ. Loop Simplify Form).
Оно обладает следующими свойствами:
\begin{itemize}
    \item У цикла есть предзаголовок.
    \item У цикла единственное обратное ребро.
    \item Все ребра, входящие в блоки выхода, выходят из цикла. Таким образом все блоки выхода доминируются заголовком цикла.
\end{itemize}
Остальные представления строятся на основе упрощенного представления циклов.

\section{Расположение инварианта цикла в упрощенном представлении}

Рассмотрим варианты расположения инварианта цикла в упрощенном представлении:
\begin{itemize}
    \item В теле цикла.

        Это расположение зачастую получается при построении внутреннего представления и редко является оптимальным, так как часто число итераций цикла больше единицы.

    \item В предзаголовке цикла.

        Такое расположение будет оптимальным для цикла, в теле которого используется инвариант, и число итераций которого больше единицы.

    \item В некоторых блоках выхода цикла.

        Этот вариант расположения доступен только в том случае, если инвариант не используется внутри цикла.
        Данный подход является оптимальным, при условии минимизации суммарной частоты выходных блоков в которые распологаются копии инварианта и дальнейшей пропагации инструкции без учета циклов.
\end{itemize}

Универсальным подходом является вынос инварианта из тела цикла в предзаголовок.
Однако, как было показано на примере функции \texttt{S\_regmatch}, этот метод может быть неэффективным если среднее число итераций цикла мало.

\section{Формальная постановка задачи расположения инвариантов цикла}

Рассмотрим задачу оптимального расположения инвариантов цикла формально.

Для каждого цикла, рассматривается множество блоков, доминируемых предзаголовком $p$

$$D = \{ \: d : p \: dom \: d \: \}$$.

Для каждого инварианта $i$ необходимо найти, такое множество $M$ что:
\begin{itemize}
    \item $M \subset D$
    \item $\forall \: u \in U(i) \: \exists \: m \in M : m \: dom \: u $, где $U(i)$ - множество блоков, содержащих использование инварианта $i$.
    \item $\sum_{m \in M}{f(m)} \to min $, где $f(m)$ - оценка частоты вероятности исполнения блока $m$.
\end{itemize}
\newpage
